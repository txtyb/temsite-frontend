<template>
  <!-- <img src="./assets/logo.png">
  <div>
    <p>
      If Element Plus is successfully added to this project, you'll see an
      <code v-text="'<el-button>'"></code>
      below
    </p>
    <el-button type="primary">el-button</el-button>
  </div>
  <HelloWorld msg="Welcome to Your Vue.js App"/> -->
  <div class="common-layout">
    <el-container>
      <el-header>
        <el-row>
          <el-col :span="10">
            <span class="title">温湿度监测</span>
          </el-col>
          <el-col :span="8">
            <div class="slider-block">
              <el-slider
                v-model="dataNum"
                show-input
                @click="refresh"
                label="123"
              />
            </div>
          </el-col>
          <el-col :span="4">
            <el-button type="primary" @click="refresh"
              >刷新 {{ setAutoRefresh }}</el-button
            >
          </el-col>
          <el-col :span="2" :pull="1">
            <el-switch
              class="refreshSwitch"
              v-model="setAutoRefresh"
              active-text="自动刷新"
              inline-prompt
              :active-icon="Check"
              :inactive-icon="Close"
              @change="refreshSwitch"
            />
          </el-col>
        </el-row>
      </el-header>
      <el-main>
        <el-card class="box-card">
          <el-space direction="horizonal" :fill="true" warp class="charts">
            <div class="chart">
              <line-chart
                :data="temdata"
                :min="null"
                :max="null"
                xtitle="时间"
                ytitle="温度℃"
              ></line-chart>
            </div>
            <el-divider />
            <div class="chart">
              <area-chart
                :data="rhdata"
                :min="null"
                :max="null"
                xtitle="时间"
                ytitle="湿度%"
              ></area-chart>
            </div>
            <!-- <area-chart
            :data="fetchData"
            :min="null"
            :max="null"
            xtitle="时间"
            ytitle="湿度%"
          ></area-chart> -->
          </el-space>
        </el-card>
        <el-card class="tables">
          <!-- <el-space direction="horizonal" :fill="true" warp> -->
          <el-table :data="tableData" style="width: 100%" max-height="250">
            <el-table-column fixed prop="time" label="时间" width="600" />
            <el-table-column prop="tem" label="温度" width="120" />
            <el-table-column fixed="right" prop="rh" label="湿度" width="120" />
          </el-table>
          <!-- </el-space> -->
        </el-card>
      </el-main>
      <el-footer>
        <el-card>
          <div class="rawdata">
            <p>raw tem: {{ temdata }}</p>
            <p>raw rh: {{ rhdata }}</p>
          </div>
        </el-card>
      </el-footer>
    </el-container>
  </div>
  <!-- <line-chart :data="[[new Date(), 5], [1368174456, 4], ['2017-01-01 00:00:00 UTC', 7]]"></line-chart> -->
</template>

<script>
// import HelloWorld from './components/HelloWorld.vue'

export default {
  // el: "#app",
  name: "App",
  data() {
    return {
      // temdata: "",
      rhdata: "",
      temdata: "",
      tableData: [],
      // temdata: [[1650857228, 34.1], [1650857235, 33.9], [1650857243, 33.8], [1650857251, 33.7], [1650857259, 34.2], [1650857267, 34.5], [1650857275, 34.7], [1650857283, 34.8], [1650857291, 34.8], [1650857299, 34.9], [1650857307, 34.8], [1650857314, 34.7], [1650857322, 34.7], [1650857330, 34.7], [1650857338, 34.7], [1650857346, 34.6], [1650857354, 34.5], [1650857362, 34.5], [1650857370, 34.5], [1650857378, 34.5], [1650857385, 34.5], [1650857393, 34.5], [1650857401, 34.4], [1650857409, 34.3], [1650857417, 34.3], [1650857425, 34.3], [1650857433, 34.1], [1650857441, 34.0], [1650857449, 33.9], [1650857457, 33.7], [1650857464, 33.5], [1650857472, 33.3], [1650857480, 33.1], [1650857488, 32.9], [1650857496, 32.7], [1650857504, 32.5], [1650857512, 32.4], [1650857520, 32.2], [1650857528, 32.0], [1650857536, 31.9], [1650857544, 31.7], [1650857551, 31.5], [1650857560, 31.4], [1650857568, 31.3], [1650857576, 31.2], [1650857584, 31.1], [1650857591, 31.0], [1650857599, 31.0], [1650857607, 30.9], [1650857615, 30.8], [1650857623, 30.8], [1650857631, 30.7], [1650857639, 30.6], [1650857647, 30.6], [1650857655, 30.5], [1650857662, 30.4], [1650857670, 30.4], [1650857678, 30.4], [1650857686, 30.3], [1650857694, 30.2], [1650857702, 30.2], [1650857710, 30.2], [1650857718, 30.1], [1650857725, 30.1], [1650857733, 30.0], [1650857741, 30.0], [1650857749, 29.9], [1650857757, 29.9], [1650857765, 29.8], [1650857773, 29.8], [1650857781, 29.8], [1650857789, 29.7], [1650857796, 29.7], [1650857804, 29.7], [1650857812, 29.6], [1650857820, 29.6], [1650857828, 29.6], [1650857836, 29.6], [1650857844, 29.5], [1650857852, 29.5], [1650857860, 29.5], [1650857868, 29.4], [1650857876, 29.4], [1650857883, 29.4], [1650857891, 29.4], [1650857899, 29.4], [1650857907, 29.3], [1650857915, 29.3], [1650857923, 29.3], [1650857931, 29.3], [1650857939, 29.3], [1650857947, 29.2], [1650857955, 29.3], [1650857962, 29.2], [1650857970, 29.2], [1650857978, 29.2], [1650857986, 29.2], [1650857994, 29.3], [1650858002, 29.2], [1650858010, 29.3], [1650858019, 29.2], [1650858027, 29.2], [1650858035, 29.2], [1650858043, 29.2], [1650858051, 29.2], [1650858059, 29.2], [1650858067, 29.2], [1650858075, 29.2], [1650858083, 29.2], [1650858090, 29.3], [1650858098, 29.3], [1650858106, 29.3], [1650858114, 29.3], [1650858122, 29.3], [1650858130, 29.3], [1650858138, 29.3], [1650858146, 29.3], [1650858180, 29.3], [1650858188, 29.3], [1650858196, 29.3], [1650858228, 29.2], [1650858236, 29.2], [1650858244, 29.3], [1650858255, 29.3], [1650858284, 29.2], [1650858292, 29.3], [1650858300, 29.3], [1650858308, 29.3], [1650858316, 29.2], [1650858324, 29.2], [1650858332, 29.2], [1650858340, 29.2], [1650858348, 29.2], [1650858356, 29.2], [1650858364, 29.1], [1650858372, 29.1], [1650858380, 29.1], [1650858388, 29.1], [1650858396, 29.1], [1650858404, 29.1], [1650858411, 29.1], [1650858419, 29.1], [1650858427, 29.0], [1650858435, 29.0], [1650858443, 29.0], [1650858451, 29.0], [1650858459, 29.0], [1650858467, 29.0], [1650858475, 29.0], [1650858483, 29.0], [1650858491, 29.0], [1650858498, 29.0], [1650858506, 29.0], [1650858514, 29.0], [1650858522, 29.1], [1650858530, 29.1], [1650858538, 29.1], [1650858546, 29.1], [1650858554, 29.1], [1650858562, 29.1], [1650858570, 29.2], [1650858578, 29.2], [1650858586, 29.2], [1650858594, 29.3], [1650858602, 29.2], [1650858610, 29.2], [1650858618, 29.3], [1650858626, 29.2], [1650858633, 29.3], [1650858641, 29.3], [1650858649, 29.2], [1650858657, 29.2], [1650858665, 29.2], [1650858673, 29.2], [1650858681, 29.2], [1650858689, 29.2], [1650858697, 29.2], [1650858705, 29.2], [1650858713, 29.2], [1650858721, 29.2], [1650858729, 29.2], [1650858737, 29.2], [1650858744, 29.2], [1650858752, 29.2], [1650858760, 29.2], [1650858768, 29.2], [1650858776, 29.2], [1650858784, 29.2], [1650858792, 29.2], [1650858800, 29.1], [1650858808, 29.1], [1650858816, 29.1], [1650858824, 29.1], [1650858832, 29.1], [1650858840, 29.1], [1650858847, 29.1], [1650858855, 29.1], [1650858863, 29.2], [1650858871, 29.1], [1650858879, 29.2], [1650858887, 29.2], [1650858895, 29.1], [1650858903, 29.1], [1650858911, 29.1], [1650858919, 29.1], [1650858926, 29.1], [1650858934, 29.2], [1650858942, 29.2], [1650858950, 29.2], [1650858958, 29.2], [1650858966, 29.2], [1650858974, 29.2], [1650858982, 29.2], [1650858990, 29.2], [1650858997, 29.1], [1650859005, 29.1], [1650859013, 29.1], [1650859021, 29.1], [1650859029, 29.1], [1650859037, 29.0], [1650859045, 29.0], [1650859052, 29.0], [1650859061, 29.0], [1650859068, 29.0], [1650859077, 29.0], [1650859085, 29.0], [1650859093, 29.0], [1650859101, 29.0], [1650859108, 29.0], [1650859116, 29.1], [1650859124, 29.0], [1650859132, 29.1], [1650859140, 29.1], [1650859148, 29.1], [1650859156, 29.1], [1650859164, 29.1], [1650859172, 29.1], [1650859180, 29.1], [1650859188, 29.1], [1650859196, 29.1], [1650859204, 29.1], [1650859212, 29.2], [1650859220, 29.2], [1650859228, 29.1], [1650859236, 29.2], [1650859243, 29.2], [1650859251, 29.1], [1650859259, 29.2], [1650859267, 29.1], [1650859275, 29.1], [1650859283, 29.1], [1650859291, 29.1], [1650859299, 29.1], [1650859307, 29.1], [1650859315, 29.1], [1650859322, 29.0], [1650859330, 29.0], [1650859338, 29.0], [1650859346, 28.9], [1650859354, 28.9], [1650859362, 29.0], [1650859370, 29.0], [1650859378, 29.0], [1650859386, 29.0], [1650859394, 29.0], [1650859402, 29.0], [1650859409, 29.0], [1650859417, 29.0], [1650859425, 29.0], [1650859433, 29.0], [1650859441, 29.0], [1650859449, 28.9], [1650859457, 28.9], [1650859465, 28.9], [1650859473, 28.9], [1650859481, 28.9], [1650859489, 28.9], [1650859496, 28.9], [1650859504, 28.9], [1650859512, 28.9], [1650859520, 28.8], [1650859528, 28.8], [1650859536, 28.8], [1650859544, 28.8], [1650859552, 28.8], [1650859560, 28.9], [1650859568, 28.9], [1650859576, 28.8], [1650859584, 28.9], [1650859591, 28.9], [1650859599, 28.9], [1650859607, 28.9], [1650859615, 28.9], [1650859623, 28.9], [1650859631, 28.9], [1650859639, 28.9], [1650859647, 28.9], [1650859655, 28.9], [1650859663, 28.9], [1650859670, 28.9], [1650859678, 28.9], [1650859686, 28.9], [1650859694, 28.9], [1650859702, 28.9], [1650859712, 28.9], [1650859720, 28.9], [1650859728, 28.9], [1650859736, 28.9], [1650859744, 28.9], [1650859752, 28.9], [1650859759, 28.9], [1650859768, 28.9], [1650859776, 28.9]]
    };
  },
  computed: {
    fetchData() {
      return { "2021-01-01": 2, "2021-01-02": 3 };
    },
    // temdata: gettem()
  },
  created() {},
  mounted() {
    this.refresh();
    this.test();
  },
  methods: {
    // gettem() {
    //   var data;
    //   // var response = fetch("https://temsite-serverless-txtyb.vercel.app/api/gettem", {
    //   //   method: "get",
    //   // })
    //   fetch("https://temsite-serverless-txtyb.vercel.app/api/gettem", {method: 'get'})
    //   .then(res => res.json())
    //   .then(json => data = json)
    //   return data
    // },
    refresh() {
      // function updateData(url, dst) {
      //   fetch(url, {
      //     method: "get",
      //   })
      //     // .then(data => data.text())
      //     .then((data, dst) => {
      //       data.json()})
      //     .then((data, dst) => (dst = data));
      // }
      var url =
        "https://temsite-serverless-txtyb.vercel.app/api/gettem?n=" +
        this.dataNum;
      fetch(url, {
        method: "get",
      })
        // .then(data => data.text())
        .then((data) => data.json())
        .then((data) => (this.$data.temdata = data));
      // updateData(url, this.temdata);
      url =
        "https://temsite-serverless-txtyb.vercel.app/api/getrh?n=" +
        this.dataNum;
      fetch(url, {
        method: "get",
      })
        // .then(data => data.text())
        .then((data) => data.json())
        .then((data) => (this.$data.rhdata = data));
      url = "https://temsite-serverless-txtyb.vercel.app/api/get?ts=0";
      fetch(url, {
        method: "get",
      })
        // .then(data => data.text())
        .then((data) => data.json())
        .then((data) => (this.$data.tableData = data));
      console.log("refreshed");
    },
    test() {
      console.log("this is test");
    },
    // 切换自动刷新
    refreshSwitch() {
      console.log(this.setAutoRefresh);
      if (!this.setAutoRefresh) {
        clearInterval(this.autoRefresh);
        console.log("Auto refresh disabled");
      } else {
        this.autoRefresh = setInterval(() => {
          this.refresh();
        }, 5000);
        console.log("Auto refresh enabled");
      }
    },
  },
};
</script>
  
<script setup>
import { ref } from "vue";
import { Check, Close } from "@element-plus/icons-vue";
const setAutoRefresh = ref(false);

const dataNum = ref(50);

defineExpose({
  setAutoRefresh,
  dataNum,
});
</script>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
.chart {
  margin: 15px;
}
.title {
  font-weight: bold;
  font-size: 25px;
}
.refreshSwitch {
  /* margin-left: -80px; */
  margin-top: 8px;
}
.charts {
  overflow: hidden;
}
.slider-block {
  /* display: flex; */
  align-items: center;
}
</style>
